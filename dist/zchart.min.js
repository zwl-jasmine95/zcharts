function zcharts(t){t.series.map(function(t,a){});var a={};return a.initSvg=function(t,a){function e(t){var e=$.extend(!0,[],t);if(o.newSeries=e,"pie"==e[0].type)e.map(function(t,e){t.data.map(function(t,n){t.color=a.color[(e+1)*n]})}),r(o);else{var i=[],u=[],x=[];e.map(function(t,a){if("bar"==t.type)if(i.push(t),t.stack)if(x||x.length){var e=0;x.map(function(a,n){t.stack==a&&(e=1)}),0==e&&x.push(t.stack)}else x.push(t.stack);else x.push(t.name);else"line"==t.type&&u.push(t)});var g=d3.layout.stack().values(function(t,a){return t.data}),f={};i.map(function(t,e){var n=[];t.data.map(function(t,e){var l={};l.x=a.xAxis.data[e],l.y=t,n.push(l)}),t.data=n;var l=t.stack||t.name;f[l]=f[l]||[],f[l].push(t)});for(var y in f){var h=f[y];g(h),h.map(function(t,a){i.map(function(a,e){a.name==t.name&&(a.data=t.data)})})}var m={};u.map(function(t,e){var n=[];t.data.map(function(t,e){var l={};l.x=a.xAxis.data[e],l.y=t,n.push(l)}),t.data=n;var l=t.stack||t.name;m[l]=m[l]||[],m[l].push(t)});for(var y in m){var h=m[y];g(h),h.map(function(t,a){u.map(function(a,e){a.name==t.name&&(a.data=t.data)})})}var v={};v.xName=a.xAxis.name,v.xLabel=a.xAxis.data,v.xScale=d3.scale.ordinal().domain(v.xLabel).rangeRoundBands([0,s-p.left-p.right],.1),v.xAxisScale=d3.scale.ordinal().domain(x).rangeRoundBands([0,v.xScale.rangeBand()],.1),v.xAxis=d3.svg.axis().scale(v.xScale).orient("bottom").tickPadding(10);var A={};A.yAxis=[],A.yName=[];var S=0,b=0;console.log(JSON.stringify(e)),e.map(function(t,a){var e=d3.max(t.data,function(t,a){return t.y+t.y0});0==t.yAxisIndex?S=S>e?S:e:1==t.yAxisIndex&&(b=b>e?b:e)}),a.yAxis.map(function(t,a){A.yName.push(t.name)}),A.yScale0=d3.scale.linear().domain([0,S]).range([c-p.top-p.bottom,0]);var k=d3.svg.axis().scale(A.yScale0).orient("left").tickPadding(10);A.yScale1=d3.scale.linear().domain([0,b]).range([c-p.top-p.bottom,0]);var w=d3.svg.axis().scale(A.yScale1).orient("right").tickPadding(10);A.yAxis.push(k),A.yAxis.push(w),d.append("g").attr("class","x axis").attr("transform","translate("+p.left+","+(c-p.bottom)+")").call(v.xAxis).append("text").text(v.xName).attr("transform","translate("+(s-p.right-p.left)+",25)"),d3.selectAll("g.x g.tick text").attr("x",-a.xAxis.xAxisLable.margin).attr("transform","rotate("+a.xAxis.xAxisLable.rotate+")"),a.yAxis.map(function(t,a){var e;0==a?e=d.append("g").attr("class","y axis").attr("transform","translate("+p.left+","+p.top+")").call(A.yAxis[a]):1==a&&(e=d.append("g").attr("class","y axis").attr("transform","translate("+(s-p.right)+","+p.top+")").call(A.yAxis[a])),e.append("text").text(A.yName[a]).attr("transform","translate(-25,-15)")}),o.x=v,o.y=A,o.barData=i,o.lineData=u,i&&i.length&&n(o),u&&u.length&&l(o)}}function n(t){var a={svg:null,tooltip:null,width:null,height:null,padding:null,barData:null,xAxisBarNum:null,x:null,y:null},e=(t.width||a.width,t.height||a.height),n=t.svg||a.svg,l=t.tooltip||a.tooltip,r=t.padding||a.padding,i=t.barData||a.barData,o=t.x||a.x,s=t.y||a.y;i.map(function(t,a){var l=n.append("g").attr("class","rectGroup").attr("fill",t.color).attr("transform","translate("+r.left+","+r.top+")"),i=l.selectAll(".rect"+a).data(t.data).enter().append("rect").attr("width",o.xAxisScale.rangeBand()).attr("fill",t.color);t.stack?i.attr("x",function(a,e){return o.xScale(a.x)+o.xAxisScale(t.stack)}):i.attr("x",function(a,e){return o.xScale(a.x)+o.xAxisScale(t.name)}),0==t.yAxisIndex?i.attr("y",function(t,a){return s.yScale0(t.y0)-(e-r.top-r.bottom-s.yScale0(t.y))}).attr("height",function(t,a){return e-r.top-r.bottom-s.yScale0(t.y)}):1==t.yAxisIndex&&i.attr("y",function(t,a){return s.yScale1(t.y+t.y0)}).attr("height",function(t,a){return e-s.yScale1(t.y+t.y0)-r.top-r.bottom})}),n.selectAll("rect").on("mouseover",function(t,a){d3.select(this).attr("opacity",.8),l.html(i[Math.floor(a/o.xLabel.length)].name+"<br />"+t.x+":"+t.y).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",.6)}).on("mousemove",function(t){l.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){d3.select(this).attr("opacity",1),l.style("opacity",0)})}function l(t){var a={svg:null,tooltip:null,padding:null,lineData:null,x:null,y:null},e=t.svg||a.svg,n=t.tooltip||a.tooltip,l=t.padding||a.padding,r=t.lineData||a.lineData,i=t.x||a.x,o=t.y||a.y;r.map(function(t,a){var n,r;0==t.yAxisIndex?n=d3.svg.line().x(function(t,a){return i.xScale(t.x)}).y(function(t,a){return o.yScale0(t.y+t.y0)}).interpolate("linear"):1==t.yAxisIndex&&(n=d3.svg.line().x(function(t,a){return i.xScale(t.x)}).y(function(t,a){return o.yScale1(t.y+t.y0)}).interpolate("linear"));var s=e.append("g").attr("class","lineGroup");s.append("path").attr("class","line").attr("stroke",t.color).attr("d",n(t.data)).attr("transform","translate("+(l.left+i.xScale.rangeBand()/2)+","+l.top+")"),r=s.selectAll(".circle").data(t.data).enter().append("circle").attr("class","linecircle").attr("cx",n.x()).attr("cy",n.y()).attr("r",3).attr("stroke",t.color).attr("transform","translate("+(l.left+i.xScale.rangeBand()/2)+","+l.top+")")}),e.selectAll("circle").on("mouseover",function(t,a){d3.select(this).style("fill",r[Math.floor(a/i.xLabel.length)].color).attr("r",3.5),n.html(r[Math.floor(a/i.xLabel.length)].name+"<br />"+t.x+":"+t.y).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",.6)}).on("mousemove",function(t){n.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){d3.select(this).style("fill","#fff").attr("r",3),n.style("opacity",0)})}function r(t){var a={svg:null,tooltip:null,width:null,height:null,newSeries:null},e=t.width||a.width,n=t.height||a.height,l=t.svg||a.svg,r=t.tooltip||a.tooltip,i=t.newSeries||a.newSeries,o=d3.layout.pie();i.map(function(t,a){var i=[];t.data.map(function(t,a){i.push(t.value)});var s=o(i),c=d3.svg.arc().innerRadius(t.radius[0]).outerRadius(t.radius[1]),p=l.append("g").attr("class","piebox"),d=p.selectAll("g").data(s).enter().append("g").attr("transform","translate("+e*t.center[0]+","+n*t.center[1]+")");d.on("mouseover",function(a,e){d3.select(this).attr("opacity",.6),r.html(t.name+"<br />"+t.data[e].name+":"+t.data[e].value).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",.6)}).on("mousemove",function(t){r.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){d3.select(this).attr("opacity",1),r.style("opacity",0)});d.append("path").attr("fill",function(a,e){return t.data[e].color}).attr("d",function(t){return c(t)});d.append("text").attr("transform",function(t){return"translate("+c.centroid(t)+")"}).attr("text-anchor","middle").text(function(t){return t.data})})}function i(t){var a={svg:null,height:null,width:null,tooltip:null,padding:null,lineData:null,barData:null,legend:null,initSeries:null},n=t.svg||a.svg,l=t.height||a.height,r=t.padding||a.padding,i=(t.width||a.width,t.initSeries||a.initSeries),o=(t.newSeries||a.newSeries,n.append("g").attr("class","legendBox").attr("transform","translate("+r.left+","+(l-r.bottom/2)+")"));i.map(function(t,a){var l=o.append("g").attr("class","legendGroup").attr("tag",1).attr("color",t.color).attr("transform","translate("+a%5*110+","+23*Math.floor(a/5)+")");if("bar"==t.type)l.append("rect").attr("fill",t.color).attr("width",30).attr("height",15);else if("line"==t.type){var r=l.append("g").attr("tag",1).attr("class","lineTag").attr("stroke",t.color);r.append("line").attr("class","boldLine").attr("x1",0).attr("y1",7).attr("x2",11).attr("y2",7),r.append("circle").attr("fill","#fff").attr("cx",15).attr("cy",7).attr("r",4),r.append("line").attr("class","boldLine").attr("x1",19).attr("y1",7).attr("x2",30).attr("y2",7)}l.append("text").attr("fill","black").attr("x",a+35).attr("y",12).text(t.name),o.selectAll(".legendGroup").on("click",function(t,a){var l=d3.select(this),r=d3.select(this).attr("color");1==l.attr("tag")?(l.select("rect").attr("fill","#c0c0c0"),l.select(".lineTag").attr("stroke","#c0c0c0"),l.select("text").attr("fill","#c0c0c0"),l.attr("tag",0)):(l.select("rect").attr("fill",r),l.select(".lineTag").attr("stroke",r),l.select("text").attr("fill","#000"),l.attr("tag",1));var o=[];n.selectAll(".legendGroup").each(function(t,a){1==d3.select(this).attr("tag")&&o.push(i[a])}),n.selectAll("svg>g:not(.legendBox)").remove(),console.log(o),e(o)})})}var o={},s=a.container.width,c=a.container.height,p=a.padding,d=d3.select("body").select("#"+t).append("svg").attr("width",s).attr("height",c),u=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);o.svg=d,o.width=s,o.height=c,o.padding=p,o.initSeries=a.series,o.legend=a.legend,o.tooltip=u,a.series.map(function(t,e){t.color=a.color[e]}),e(a.series),i(o)},a}