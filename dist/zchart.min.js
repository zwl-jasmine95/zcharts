function zcharts(t){t.series.map(function(t,a){});var a={};return a.drawSvg=function(t,e){var n={},l=e.container.width,r=e.container.height,i=e.padding,o=d3.select("body").select("#"+t).append("svg").attr("width",l).attr("height",r),s=d3.select("body").append("div").attr("class","tooltip").style("opacity",0);if(n.svg=o,n.width=l,n.height=r,n.padding=i,n.series=e.series,n.legend=e.legend,n.tooltip=s,"pie"==e.series[0].type)e.series.map(function(t,a){t.data.map(function(t,n){t.color=e.color[(a+1)*n]})}),a.drawPie(n);else{var c=[],d=[],p=[];e.series.map(function(t,a){if(t.color=e.color[a],"bar"==t.type)if(c.push(t),t.stack)if(p||p.length){var n=0;p.map(function(a,e){t.stack==a&&(n=1)}),0==n&&p.push(t.stack)}else p.push(t.stack);else p.push(t.name);else"line"==t.type&&d.push(t)});var u=d3.layout.stack().values(function(t,a){return t.data}),x={};c.map(function(t,a){var n=[];t.data.map(function(t,a){var l={};l.x=e.xAxis.data[a],l.y=t,n.push(l)}),t.data=n;var l=t.stack||t.name;x[l]=x[l]||[],x[l].push(t)});for(var f in x){var y=x[f];u(y),y.map(function(t,a){c.map(function(a,e){a.name==t.name&&(a.data=t.data)})})}var g={};d.map(function(t,a){var n=[];t.data.map(function(t,a){var l={};l.x=e.xAxis.data[a],l.y=t,n.push(l)}),t.data=n;var l=t.stack||t.name;g[l]=g[l]||[],g[l].push(t)});for(var f in g){var y=g[f];u(y),y.map(function(t,a){d.map(function(a,e){a.name==t.name&&(a.data=t.data)})})}var m={};m.xName=e.xAxis.name,m.xLabel=e.xAxis.data,m.xScale=d3.scale.ordinal().domain(m.xLabel).rangeRoundBands([0,l-i.left-i.right],.1),m.xAxisScale=d3.scale.ordinal().domain(p).rangeRoundBands([0,m.xScale.rangeBand()],.1),m.xAxis=d3.svg.axis().scale(m.xScale).orient("bottom").tickPadding(10);var h={};h.yAxis=[],h.yName=[];var v=0,A=0;e.series.map(function(t,a){var e=d3.max(t.data,function(t,a){return t.y+t.y0});0==t.yAxisIndex?v=v>e?v:e:1==t.yAxisIndex&&(A=A>e?A:e)}),e.yAxis.map(function(t,a){h.yName.push(t.name)}),h.yScale0=d3.scale.linear().domain([0,v]).range([r-i.top-i.bottom,0]);var b=d3.svg.axis().scale(h.yScale0).orient("left").tickPadding(10);h.yScale1=d3.scale.linear().domain([0,A]).range([r-i.top-i.bottom,0]);var S=d3.svg.axis().scale(h.yScale1).orient("right").tickPadding(10);h.yAxis.push(b),h.yAxis.push(S),o.append("g").attr("class","x axis").attr("transform","translate("+i.left+","+(r-i.bottom)+")").call(m.xAxis).append("text").text(m.xName).attr("transform","translate("+(l-i.right-i.left)+",25)"),d3.selectAll("g.x g.tick text").attr("x",-e.xAxis.xAxisLable.margin).attr("transform","rotate("+e.xAxis.xAxisLable.rotate+")"),e.yAxis.map(function(t,a){var e;0==a?e=o.append("g").attr("class","y axis").attr("transform","translate("+i.left+","+i.top+")").call(h.yAxis[a]):1==a&&(e=o.append("g").attr("class","y axis").attr("transform","translate("+(l-i.right)+","+i.top+")").call(h.yAxis[a])),e.append("text").text(h.yName[a]).attr("transform","translate(-25,-15)")}),n.x=m,n.y=h,n.barData=c,n.lineData=d,c&&c.length&&a.drawBar(n),d&&d.length&&a.drawLine(n)}},a.drawBar=function(t){var a={svg:null,tooltip:null,width:null,height:null,padding:null,barData:null,xAxisBarNum:null,x:null,y:null},e=(t.width||a.width,t.height||a.height),n=t.svg||a.svg,l=t.tooltip||a.tooltip,r=t.padding||a.padding,i=t.barData||a.barData,o=t.x||a.x,s=t.y||a.y;i.map(function(t,a){var l=n.append("g").attr("class","rectGroup").attr("fill",t.color).attr("transform","translate("+r.left+","+r.top+")"),i=l.selectAll(".rect"+a).data(t.data).enter().append("rect").attr("width",o.xAxisScale.rangeBand()).attr("fill",t.color);t.stack?i.attr("x",function(a,e){return o.xScale(a.x)+o.xAxisScale(t.stack)}):i.attr("x",function(a,e){return o.xScale(a.x)+o.xAxisScale(t.name)}),0==t.yAxisIndex?i.attr("y",function(t,a){return s.yScale0(t.y0)-(e-r.top-r.bottom-s.yScale0(t.y))}).attr("height",function(t,a){return e-r.top-r.bottom-s.yScale0(t.y)}):1==t.yAxisIndex&&i.attr("y",function(t,a){return s.yScale1(t.y+t.y0)}).attr("height",function(t,a){return e-s.yScale1(t.y+t.y0)-r.top-r.bottom})}),n.selectAll("rect").on("mouseover",function(t,a){d3.select(this).attr("opacity",.8),l.html(i[Math.floor(a/o.xLabel.length)].name+"<br />"+t.x+":"+t.y).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",.6)}).on("mousemove",function(t){l.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){d3.select(this).attr("opacity",1),l.style("opacity",0)})},a.drawLine=function(t){var a={svg:null,tooltip:null,padding:null,lineData:null,x:null,y:null},e=t.svg||a.svg,n=t.tooltip||a.tooltip,l=t.padding||a.padding,r=t.lineData||a.lineData,i=t.x||a.x,o=t.y||a.y;r.map(function(t,a){var n,r;0==t.yAxisIndex?n=d3.svg.line().x(function(t,a){return i.xScale(t.x)}).y(function(t,a){return o.yScale0(t.y+t.y0)}).interpolate("linear"):1==t.yAxisIndex&&(n=d3.svg.line().x(function(t,a){return i.xScale(t.x)}).y(function(t,a){return o.yScale1(t.y+t.y0)}).interpolate("linear")),e.append("path").attr("class","line").attr("stroke",t.color).attr("d",n(t.data)).attr("transform","translate("+(l.left+i.xScale.rangeBand()/2)+","+l.top+")"),r=e.selectAll(".circle").data(t.data).enter().append("circle").attr("class","linecircle").attr("cx",n.x()).attr("cy",n.y()).attr("r",3).attr("stroke",t.color).attr("transform","translate("+(l.left+i.xScale.rangeBand()/2)+","+l.top+")")}),e.selectAll("circle").on("mouseover",function(t,a){d3.select(this).style("fill",r[Math.floor(a/i.xLabel.length)].color).attr("r",3.5),n.html(r[Math.floor(a/i.xLabel.length)].name+"<br />"+t.x+":"+t.y).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",.6)}).on("mousemove",function(t){n.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){d3.select(this).style("fill","#fff").attr("r",3),n.style("opacity",0)})},a.drawPie=function(t){var a={svg:null,tooltip:null,width:null,height:null,series:null},e=t.width||a.width,n=t.height||a.height,l=t.svg||a.svg,r=t.tooltip||a.tooltip,i=t.series||a.series,o=d3.layout.pie();i.map(function(t,a){var i=[];t.data.map(function(t,a){i.push(t.value)});var s=o(i),c=d3.svg.arc().innerRadius(t.radius[0]).outerRadius(t.radius[1]),d=l.append("g").attr("class","piebox"),p=d.selectAll("g").data(s).enter().append("g").attr("transform","translate("+e*t.center[0]+","+n*t.center[1]+")");p.on("mouseover",function(a,e){d3.select(this).attr("opacity",.6),r.html(t.name+"<br />"+t.data[e].name+":"+t.data[e].value).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px").style("opacity",.6)}).on("mousemove",function(t){r.style("left",d3.event.pageX+"px").style("top",d3.event.pageY+20+"px")}).on("mouseout",function(t){d3.select(this).attr("opacity",1),r.style("opacity",0)});p.append("path").attr("fill",function(a,e){return t.data[e].color}).attr("d",function(t){return c(t)});p.append("text").attr("transform",function(t){return"translate("+c.centroid(t)+")"}).attr("text-anchor","middle").text(function(t){return t.data})})},a.drawLegend=function(t){var a={svg:null,height:null,width:null,tooltip:null,padding:null,lineData:null,barData:null,series:null},e=t.svg||a.svg,n=t.height||a.height,l=t.padding||a.padding,r=t.width||a.width,i=t.series||a.series,o=(t.lineData||a.lineData,t.barData||a.barData,e.append("g").attr("class","legendBox").attr("transform","translate("+l.left+","+(n-l.bottom)+")"));i.map(function(t,a){console.log(t);var e=o.append("g");e.append("rect").attr("fill",t.color).attr("width",30).attr("height",20),e.append("text").attr("fill","black").attr("x",r-2*l.left).attr("y",35*(a+1)+13).text(t.name)})},a}